<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé∞ –°–ª–æ—Ç-–º–∞—à–∏–Ω–∞ –ö–∞–∑–∏–Ω–æ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px;
        }

        .casino-container {
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            border: 1px solid rgba(255, 255, 255, 0.18);
            max-width: 400px;
            width: 90%;
        }

        h1 {
            color: #fff;
            margin-bottom: 10px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .subtitle {
            color: #f0f0f0;
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        .info-panel {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            color: #fff;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            font-size: 1.1em;
        }

        .coins {
            color: #f9ca24;
            font-weight: bold;
        }

        .spins-left {
            color: #4ecdc4;
            font-weight: bold;
        }

        /* Slot Machine Styles */
        .slot-machine {
            background: linear-gradient(145deg, #2c2c2c, #1a1a1a);
            border: 8px solid #444;
            border-radius: 20px;
            padding: 20px;
            margin: 40px auto;
            box-shadow: 
                0 10px 30px rgba(0, 0, 0, 0.5),
                inset 0 2px 5px rgba(255, 255, 255, 0.1);
            position: relative;
            max-width: 320px;
        }

        .slot-machine-header {
            position: absolute;
            top: -45px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(145deg, #2c2c2c, #1a1a1a);
            padding: 4px 9px;
            border-radius: 15px;
            border: 3px solid #444;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
        }

        .dog-image {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #666;
        }

        .dog-emoji {
            font-size: 3em;
            display: none;
        }

        .dog-image.error + .dog-emoji {
            display: block;
        }

        .dog-image.error {
            display: none;
        }

        .reels-container {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
            padding: 15px;
            background: #000;
            border-radius: 10px;
            border: 3px solid #333;
            box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.8);
        }

        .reel {
            width: 70px;
            height: 70px;
            background: linear-gradient(180deg, #333, #111);
            border: 2px solid #555;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.2em;
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.5);
        }

        .reel-symbols {
            display: flex;
            flex-direction: column;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            transition: transform 2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .symbol {
            width: 40px;
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8em;
            line-height: 1;
        }

        .spin-button {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.2em;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
            margin: 20px 0;
            min-width: 200px;
        }

        .spin-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.6);
        }

        .spin-button:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .result-display {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            color: #fff;
            font-size: 1.2em;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .win-animation {
            animation: jackpot 0.8s ease-in-out infinite alternate;
        }

        @keyframes jackpot {
            from { 
                transform: scale(1); 
                color: #fff;
                text-shadow: 0 0 5px #fff;
            }
            to { 
                transform: scale(1.1); 
                color: #f9ca24;
                text-shadow: 0 0 20px #f9ca24;
            }
        }

        .loading {
            display: none;
            color: #fff;
            font-size: 1.1em;
            margin: 10px 0;
        }

        .loading.show {
            display: block;
        }

        .payline-indicator {
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 2px;
            background: #ff6b6b;
            transform: translateY(-50%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .payline-indicator.active {
            opacity: 1;
            box-shadow: 0 0 10px #ff6b6b;
        }

        .prize-table {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 15px;
            margin: 20px 0;
            color: #fff;
            font-size: 0.9em;
        }

        .prize-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .prize-row:last-child {
            border-bottom: none;
        }

        .symbols-combo {
            font-size: 1.2em;
        }

        .prize-amount {
            color: #f9ca24;
            font-weight: bold;
        }

        .spinning .reel {
            animation: reel-glow 0.5s ease-in-out infinite alternate;
        }

        @keyframes reel-glow {
            from { box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.5); }
            to { box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.5), 0 0 15px rgba(255, 107, 107, 0.5); }
        }

        .jackpot-flash {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 215, 0, 0.3);
            opacity: 0;
            pointer-events: none;
            z-index: 9999;
        }

        .jackpot-flash.active {
            animation: flash 0.5s ease-in-out 3;
        }

        @keyframes flash {
            0%, 100% { opacity: 0; }
            50% { opacity: 1; }
        }
        /* –ê—É–¥–∏–æ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä */
        .audio-controls {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 25px;
            padding: 10px;
            display: flex;
            gap: 10px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .audio-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .audio-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.05);
        }

        .audio-btn.active {
            background: rgba(255, 107, 107, 0.7);
            box-shadow: 0 0 10px rgba(255, 107, 107, 0.5);
        }

        @media (max-width: 480px) {
            .audio-controls {
                top: 10px;
                right: 10px;
                padding: 8px;
            }
            
            .audio-btn {
                padding: 6px 10px;
                font-size: 14px;
            }
        }
        
        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            opacity: 1;
            transition: opacity 0.5s ease-out;
        }
        
        .loading-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .loading-content {
            text-align: center;
            color: white;
        }
        
        .loading-title {
            font-size: 3em;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .loading-subtitle {
            font-size: 1.2em;
            margin-bottom: 30px;
            opacity: 0.9;
        }
        
        .loading-spinner {
            position: relative;
            width: 80px;
            height: 80px;
            margin: 0 auto 30px;
        }
        
        .loading-spinner::before {
            content: 'üé∞';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3em;
            animation: spin 2s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }
        
        .loading-progress {
            width: 300px;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            overflow: hidden;
            margin: 20px auto;
        }
        
        .loading-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #ff6b6b, #f9ca24);
            border-radius: 2px;
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .loading-text {
            font-size: 1em;
            opacity: 0.8;
            margin-top: 10px;
        }
        
        .loading-dots {
            display: inline-block;
        }
        
        .loading-dots::after {
            content: '';
            animation: dots 1.5s infinite;
        }
        
        @keyframes dots {
            0%, 20% { content: ''; }
            40% { content: '.'; }
            60% { content: '..'; }
            80%, 100% { content: '...'; }
        }
        
        @keyframes pulse {
            0% { transform: scale(1.05); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1.05); }
        }
        
        @media (max-width: 480px) {
            .loading-title {
                font-size: 2.5em;
            }
            
            .loading-subtitle {
                font-size: 1em;
            }
            
            .loading-progress {
                width: 250px;
            }
        }
    </style>
</head>
<body>
    <!-- –ê—É–¥–∏–æ —ç–ª–µ–º–µ–Ω—Ç—ã -->
    <audio id="bgMusic" loop>
        <source src="audio/casino_ambient.mp3" type="audio/mpeg">
        <source src="audio/casino_ambient.ogg" type="audio/ogg">
    </audio>
    
    <audio id="spinSound">
        <source src="audio/slot_spin.mp3" type="audio/mpeg">
        <source src="audio/slot_spin.ogg" type="audio/ogg">
    </audio>
    
    <audio id="winSound">
        <source src="audio/win.mp3" type="audio/mpeg">
        <source src="audio/win.ogg" type="audio/ogg">
    </audio>
    
    <audio id="jackpotSound">
        <source src="audio/jackpot.mp3" type="audio/mpeg">
        <source src="audio/jackpot.ogg" type="audio/ogg">
    </audio>
    
    <!-- –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –∞—É–¥–∏–æ -->
    <div class="audio-controls">
        <button class="audio-btn" id="musicToggle" onclick="toggleMusic()" title="–í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å –º—É–∑—ã–∫—É">
            üéµ
        </button>
        <button class="audio-btn" id="soundToggle" onclick="toggleSounds()" title="–í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å –∑–≤—É–∫–∏">
            üîä
        </button>
    </div>
    
    <div class="jackpot-flash" id="jackpot-flash"></div>
    
    <div class="casino-container">
        <h1>üé∞ –°–ª–æ—Ç-–º–∞—à–∏–Ω–∞</h1>
        <p class="subtitle">–¢—Ä–∏ –≤ —Ä—è–¥ –¥–ª—è –≤—ã–∏–≥—Ä—ã—à–∞!</p>
        
        <div class="info-panel">
            <div class="info-item">
                <span>üéØ –°–ø–∏–Ω–æ–≤ –æ—Å—Ç–∞–ª–æ—Å—å:</span>
                <span class="spins-left" id="spins-left">6</span>
            </div>
        </div>

        <div class="slot-machine" id="slot-machine">
            <div class="slot-machine-header">
                <img src="dog.jpg" alt="Lucky Dog" class="dog-image" id="dog-image" onerror="this.classList.add('error')">
            </div>
            <div class="payline-indicator" id="payline"></div>
            <div class="reels-container">
                <div class="reel" id="reel1">
                    <div class="reel-symbols" id="symbols1">
                        <div class="symbol">üçí</div>
                        <div class="symbol">üíé</div>
                        <div class="symbol">üçã</div>
                        <div class="symbol">üîî</div>
                        <div class="symbol">‚≠ê</div>
                        <div class="symbol">üçâ</div>
                        <div class="symbol">üí∞</div>
                    </div>
                </div>
                <div class="reel" id="reel2">
                    <div class="reel-symbols" id="symbols2">
                        <div class="symbol">üíé</div>
                        <div class="symbol">üçí</div>
                        <div class="symbol">üîî</div>
                        <div class="symbol">üçã</div>
                        <div class="symbol">üçâ</div>
                        <div class="symbol">‚≠ê</div>
                        <div class="symbol">üí∞</div>
                    </div>
                </div>
                <div class="reel" id="reel3">
                    <div class="reel-symbols" id="symbols3">
                        <div class="symbol">üçã</div>
                        <div class="symbol">üîî</div>
                        <div class="symbol">üíé</div>
                        <div class="symbol">üçí</div>
                        <div class="symbol">üí∞</div>
                        <div class="symbol">üçâ</div>
                        <div class="symbol">‚≠ê</div>
                    </div>
                </div>
            </div>
        </div>

        <button class="spin-button" id="spin-btn" onclick="spinSlots()">
            üé≤ –ö–†–£–¢–ò–¢–¨ –°–õ–û–¢–´
        </button>

        <div class="loading" id="loading">
            ‚è≥ –°–ª–æ—Ç—ã –∫—Ä—É—Ç—è—Ç—Å—è...
        </div>

        <div class="result-display" id="result">
            –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –∏–≥—Ä—É!
        </div>

        <div class="prize-table">
            <div style="text-align: center; margin-bottom: 10px; font-weight: bold;">üèÜ –¢–∞–±–ª–∏—Ü–∞ –≤—ã–ø–ª–∞—Ç</div>
            <div class="prize-row">
                <span class="symbols-combo">üéé –õ—é–±—ã–µ 3 –≤ —Ä—è–¥ üéé</span>
                <span class="prize-amount">300 BTC</span>
            </div>
            <div class="prize-row">
                <span class="symbols-combo">üòï –ù–µ —Å–æ–≤–ø–∞–ª–∏</span>
                <span class="prize-amount">0 BTC</span>
            </div>
        </div>
    </div>

    <div class="loading-screen" id="loadingScreen">
        <div class="loading-content">
            <div class="loading-title">–ó–∞–≥—Ä—É–∑–∫–∞</div>
            <div class="loading-subtitle">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ...</div>
            <div class="loading-spinner"></div>
            <div class="loading-progress">
                <div class="loading-progress-bar" id="loadingProgressBar"></div>
            </div>
            <div class="loading-text">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è<span class="loading-dots"></span></div>
            <div id="loadingButtonContainer" style="margin-top: 20px; height: 50px;"></div>
        </div>
    </div>

    <script>        
        let currentCoins = 0;
        let spinsLeft = 6;
        let isSpinning = false;
        let playerId = null;
        let apiBaseUrl = window.location.origin + '/miniapp';
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞—É–¥–∏–æ
        let musicEnabled = true;
        let soundsEnabled = true;
        let audioElements = {};
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è
        let loadingSteps = {
            player: false,
            audio: false,
            preload: false
        };
        
        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —ç–∫—Ä–∞–Ω–æ–º –∑–∞–≥—Ä—É–∑–∫–∏
        function updateLoadingProgress() {
            const completedSteps = Object.values(loadingSteps).filter(step => step).length;
            const totalSteps = Object.keys(loadingSteps).length;
            const progress = (completedSteps / totalSteps) * 100;
            
            const progressBar = document.getElementById('loadingProgressBar');
            if (progressBar) {
                progressBar.style.width = progress + '%';
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏
            const loadingText = document.querySelector('.loading-text');
            if (loadingText) {
                let text = '–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è';
                if (loadingSteps.player && !loadingSteps.audio) {
                    text = '–ó–∞–≥—Ä—É–∑–∫–∞ –∞—É–¥–∏–æ';
                } else if (loadingSteps.player && loadingSteps.audio && !loadingSteps.preload) {
                    text = '–ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤';
                } else if (completedSteps === totalSteps) {
                    text = '–ì–æ—Ç–æ–≤–æ';
                }
                
                // –ï—Å–ª–∏ –Ω–µ –≤—Å–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ, –¥–æ–±–∞–≤–ª—è–µ–º –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–æ—á–∫–∏
                if (completedSteps < totalSteps) {
                    loadingText.innerHTML = text + '<span class="loading-dots"></span>';
                } else {
                    loadingText.innerHTML = text;
                }
            }
            
            // –ï—Å–ª–∏ –≤—Å–µ —à–∞–≥–∏ –∑–∞–≤–µ—Ä—à–µ–Ω—ã, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å"
            if (completedSteps === totalSteps) {
                setTimeout(() => {
                    showContinueButton();
                }, 800); // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –ø–æ–∫–∞–∑–∞ "–ì–æ—Ç–æ–≤–æ"
            }
        }
        
        function showContinueButton() {
            console.log('–ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å');
            
            const loadingTitle = document.querySelector('.loading-title');
            const loadingSubtitle = document.querySelector('.loading-subtitle');
            const loadingText = document.querySelector('.loading-text');
            const buttonContainer = document.getElementById('loadingButtonContainer');
            const progressBar = document.getElementById('loadingProgressBar');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫
            if (loadingTitle) {
                loadingTitle.textContent = '‚úÖ –ì–æ—Ç–æ–≤–æ!';
            }
            
            if (loadingSubtitle) {
                loadingSubtitle.textContent = '–ù–∞–∂–º–∏—Ç–µ "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å" –¥–ª—è –≤—Ö–æ–¥–∞ –≤ –∫–∞–∑–∏–Ω–æ';
            }
            
            if (loadingText) {
                loadingText.innerHTML = '‚ú® –í—Å–µ —Å–∏—Å—Ç–µ–º—ã –∑–∞–ø—É—â–µ–Ω—ã!';
            }
            
            if (progressBar) {
                progressBar.style.width = '100%';
            }
            
            // –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫—É –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å
            if (buttonContainer) {
                const continueButton = document.createElement('button');
                continueButton.textContent = 'üéµ –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å';
                continueButton.onclick = continueToApp;
                continueButton.style.cssText = `
                    background: linear-gradient(45deg, #ff6b6b, #ee5a24);
                    color: white;
                    border: none;
                    padding: 15px 30px;
                    font-size: 1.2em;
                    font-weight: bold;
                    border-radius: 50px;
                    cursor: pointer;
                    box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
                    animation: pulse 2s infinite;
                    transition: all 0.3s ease;
                `;
                
                continueButton.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-2px) scale(1.05)';
                    this.style.boxShadow = '0 6px 20px rgba(255, 107, 107, 0.6)';
                });
                
                continueButton.addEventListener('mouseleave', function() {
                    this.style.transform = 'none';
                    this.style.boxShadow = '0 4px 15px rgba(255, 107, 107, 0.4)';
                });
                
                buttonContainer.appendChild(continueButton);
                console.log('–ö–Ω–æ–ø–∫–∞ –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∞');
            }
        }
        
        function continueToApp() {
            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∞—É–¥–∏–æ (—ç—Ç–æ —Å—á–∏—Ç–∞–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ–º)
            if (musicEnabled) {
                startBackgroundMusic();
            }
            
            // –°–∫—Ä—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏
            hideLoadingScreen();
        }
        
        function hideLoadingScreen() {
            const loadingScreen = document.getElementById('loadingScreen');
            if (loadingScreen) {
                loadingScreen.classList.add('hidden');
                // –£–¥–∞–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç –∏–∑ DOM —á–µ—Ä–µ–∑ –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è
                setTimeout(() => {
                    loadingScreen.remove();
                }, 500);
            }
        }
        
        function markStepComplete(step) {
            console.log(`–û—Ç–º–µ—á–∞–µ–º —à–∞–≥ –∫–∞–∫ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–π: ${step}`);
            loadingSteps[step] = true;
            updateLoadingProgress();
            console.log('–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏:', loadingSteps);
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞—É–¥–∏–æ
        function initAudio() {
            audioElements = {
                bgMusic: document.getElementById('bgMusic'),
                spinSound: document.getElementById('spinSound'),
                winSound: document.getElementById('winSound'),
                jackpotSound: document.getElementById('jackpotSound')
            };
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≥—Ä–æ–º–∫–æ—Å—Ç–∏
            if (audioElements.bgMusic) {
                audioElements.bgMusic.volume = 0.3; // 30% –≥—Ä–æ–º–∫–æ—Å—Ç–∏ –¥–ª—è —Ñ–æ–Ω–∞
            }
            if (audioElements.spinSound) {
                audioElements.spinSound.volume = 0.5;
            }
            if (audioElements.winSound) {
                audioElements.winSound.volume = 0.7;
            }
            if (audioElements.jackpotSound) {
                audioElements.jackpotSound.volume = 0.8;
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ localStorage
            const savedMusicSetting = localStorage.getItem('casinoMusicEnabled');
            const savedSoundsSetting = localStorage.getItem('casinoSoundsEnabled');
            
            if (savedMusicSetting !== null) {
                musicEnabled = savedMusicSetting === 'true';
            }
            if (savedSoundsSetting !== null) {
                soundsEnabled = savedSoundsSetting === 'true';
            }
            
            updateAudioButtons();

            // –û—Ç–º–µ—á–∞–µ–º –∫–∞–∫ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–π —à–∞–≥
            markStepComplete('audio');
        }
        
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∑–≤—É–∫–∞
        function playSound(soundName) {
            if (!soundsEnabled || !audioElements[soundName]) {
                return;
            }
            
            try {
                audioElements[soundName].currentTime = 0;
                audioElements[soundName].play().catch(e => {
                    console.log('–ù–µ —É–¥–∞–ª–æ—Å—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –∑–≤—É–∫:', soundName, e);
                });
            } catch (error) {
                console.log('–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∑–≤—É–∫–∞:', soundName, error);
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ñ–æ–Ω–æ–≤–æ–π –º—É–∑—ã–∫–æ–π
        function toggleMusic() {
            musicEnabled = !musicEnabled;
            localStorage.setItem('casinoMusicEnabled', musicEnabled.toString());
            
            if (musicEnabled) {
                startBackgroundMusic();
            } else {
                stopBackgroundMusic();
            }
            
            updateAudioButtons();
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–≤—É–∫–∞–º–∏
        function toggleSounds() {
            soundsEnabled = !soundsEnabled;
            localStorage.setItem('casinoSoundsEnabled', soundsEnabled.toString());
            updateAudioButtons();
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞—É–¥–∏–æ
        function updateAudioButtons() {
            const musicBtn = document.getElementById('musicToggle');
            const soundBtn = document.getElementById('soundToggle');
            
            if (musicBtn) {
                musicBtn.classList.toggle('active', musicEnabled);
                musicBtn.textContent = musicEnabled ? 'üéµ' : 'üîá';
            }
            
            if (soundBtn) {
                soundBtn.classList.toggle('active', soundsEnabled);
                soundBtn.textContent = soundsEnabled ? 'üîä' : 'üîá';
            }
        }
        
        // –ó–∞–ø—É—Å–∫ —Ñ–æ–Ω–æ–≤–æ–π –º—É–∑—ã–∫–∏
        function startBackgroundMusic() {
            if (musicEnabled && audioElements.bgMusic && !isSpinning) {
                audioElements.bgMusic.play().catch(e => {
                    console.log('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ñ–æ–Ω–æ–≤—É—é –º—É–∑—ã–∫—É:', e);
                });
            }
        }
        
        // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ñ–æ–Ω–æ–≤–æ–π –º—É–∑—ã–∫–∏
        function stopBackgroundMusic() {
            if (audioElements.bgMusic) {
                audioElements.bgMusic.pause();
            }
        }
        
        // –ü–∞—É–∑–∞ —Ñ–æ–Ω–æ–≤–æ–π –º—É–∑—ã–∫–∏ –≤–æ –≤—Ä–µ–º—è —Å–ø–∏–Ω–∞
        function pauseBackgroundMusic() {
            if (audioElements.bgMusic && !audioElements.bgMusic.paused) {
                audioElements.bgMusic.pause();
            }
        }
        
        // –í–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–æ–Ω–æ–≤–æ–π –º—É–∑—ã–∫–∏ –ø–æ—Å–ª–µ —Å–ø–∏–Ω–∞
        function resumeBackgroundMusic() {
            if (musicEnabled && audioElements.bgMusic && audioElements.bgMusic.paused) {
                audioElements.bgMusic.play().catch(e => {
                    console.log('–ù–µ —É–¥–∞–ª–æ—Å—å –≤–æ–∑–æ–±–Ω–æ–≤–∏—Ç—å —Ñ–æ–Ω–æ–≤—É—é –º—É–∑—ã–∫—É:', e);
                });
            }
        }

        // –°–∏–º–≤–æ–ª—ã —Å–ª–æ—Ç-–º–∞—à–∏–Ω—ã
        const symbols = ['üçí', 'üíé', 'üçã', 'üîî', '‚≠ê', 'üçâ', 'üí∞'];
        
        // –ü—Ä–æ—Å—Ç–∞—è —Ç–∞–±–ª–∏—Ü–∞ –≤—ã–ø–ª–∞—Ç: 300 BTC –∑–∞ –ª—é–±—ã–µ 3 –≤ —Ä—è–¥
        const WIN_AMOUNT = 300;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–≥—Ä–æ–∫–∞
        async function initializePlayer() {
            try {
                // –ü–æ–ª—É—á–∞–µ–º ID –∏–≥—Ä–æ–∫–∞ –∏–∑ Telegram WebApp
                if (window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.initDataUnsafe) {
                    playerId = window.Telegram.WebApp.initDataUnsafe.user?.id;
                }
                
                // –î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π ID
                if (!playerId) {
                    playerId = 123456789; // –¢–µ—Å—Ç–æ–≤—ã–π ID
                }
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–≥—Ä–æ–∫–∞ —Å —Å–µ—Ä–≤–µ—Ä–∞
                const response = await fetch(`${apiBaseUrl}/api/player/${playerId}`);
                const data = await response.json();
                
                if (data.success) {
                    currentCoins = data.data.coins;
                    spinsLeft = data.data.spins_left;
                    updateDisplay();
                    markStepComplete('player');
                } else {
                    throw new Error(data.error || 'Failed to load player data');
                }
            } catch (error) {
                console.error('Error initializing player:', error);
                // Fallback to demo data
                currentCoins = 100;
                spinsLeft = 6;
                updateDisplay();
                markStepComplete('player');
            }
        }

        function updateDisplay() {
            document.getElementById('spins-left').textContent = spinsLeft;
            
            const spinBtn = document.getElementById('spin-btn');
            if (spinsLeft <= 0) {
                spinBtn.disabled = true;
                spinBtn.textContent = 'üö´ –ù–ï–¢ –°–ü–ò–ù–û–í';
            } else {
                spinBtn.disabled = false;
                spinBtn.textContent = 'üé≤ –ö–†–£–¢–ò–¢–¨ –°–õ–û–¢–´';
            }
        }

        async function spinSlots() {
            console.log('spinSlots called', {isSpinning, spinsLeft, playerId});
            if (isSpinning || spinsLeft <= 0 || !playerId) {
                console.log('spinSlots blocked:', {isSpinning, spinsLeft, playerId});
                return;
            }

            console.log('Starting spin animation');
            isSpinning = true;
            const spinBtn = document.getElementById('spin-btn');
            const loading = document.getElementById('loading');
            const result = document.getElementById('result');
            const slotMachine = document.getElementById('slot-machine');
            const payline = document.getElementById('payline');

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –∏ –∞–Ω–∏–º–∞—Ü–∏—é
            loading.classList.add('show');
            spinBtn.disabled = true;
            result.textContent = '';
            slotMachine.classList.add('spinning');
            payline.classList.add('active');
            
            // –ü—Ä–∏–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–æ–Ω–æ–≤—É—é –º—É–∑—ã–∫—É –≤–æ –≤—Ä–µ–º—è —Å–ø–∏–Ω–∞
            pauseBackgroundMusic();
            


            try {
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–ø–∏–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä
                const response = await fetch(`${apiBaseUrl}/api/spin`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        player_id: playerId
                    })
                });
                
                const spinData = await response.json();
                
                if (spinData.success) {
                    // –ü–æ–ª—É—á–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å–ø–∏–Ω–∞
                    const slotResult = generateSlotResult(spinData.data.prize);
                    // –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º –∑–≤—É–∫ –≤—Ä–∞—â–µ–Ω–∏—è
                    playSound('spinSound');
                    // –ê–Ω–∏–º–∏—Ä—É–µ–º –≤—Ä–∞—â–µ–Ω–∏–µ –±–∞—Ä–∞–±–∞–Ω–æ–≤
                    animateReels(slotResult, () => {
                        // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –∏–≥—Ä–æ–∫–∞
                        currentCoins = spinData.data.coins;
                        spinsLeft = spinData.data.spins_left;
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—ã–∏–≥—Ä—ã—à
                        const winAmount = checkWin(slotResult);
                        
                        // –°–∫—Ä—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                        loading.classList.remove('show');
                        slotMachine.classList.remove('spinning');
                        payline.classList.remove('active');
                        
                        if (winAmount > 0) {
                            if (winAmount >= 50) {
                                // –î–∂–µ–∫–ø–æ—Ç —ç—Ñ—Ñ–µ–∫—Ç
                                triggerJackpotEffect();
                                playSound('jackpotSound');
                            } else {
                                // –û–±—ã—á–Ω—ã–π –≤—ã–∏–≥—Ä—ã—à
                                playSound('winSound');
                            }
                            result.textContent = `üéâ –í–´–ò–ì–†–´–®! +${winAmount} BTC`;
                            result.classList.add('win-animation');
                            payline.classList.add('active');
                        } else {
                            result.textContent = spinData.data.prize.text;
                        }
                        
                        setTimeout(() => {
                            result.classList.remove('win-animation');
                            payline.classList.remove('active');
                        }, 2000);

                        updateDisplay();
                        isSpinning = false;
                        
                        // –í–æ–∑–æ–±–Ω–æ–≤–ª—è–µ–º —Ñ–æ–Ω–æ–≤—É—é –º—É–∑—ã–∫—É –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å–ø–∏–Ω–∞
                        setTimeout(() => {
                            resumeBackgroundMusic();
                        }, 500); // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞
                    });
                } else {
                    throw new Error(spinData.error || 'Spin failed');
                }
            } catch (error) {
                console.error('Error spinning slots:', error);
                loading.classList.remove('show');
                slotMachine.classList.remove('spinning');
                payline.classList.remove('active');
                result.textContent = `‚ùå –û—à–∏–±–∫–∞: ${error.message}`;
                isSpinning = false;
                spinBtn.disabled = false;
                
                // –í–æ–∑–æ–±–Ω–æ–≤–ª—è–µ–º –º—É–∑—ã–∫—É –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ
                setTimeout(() => {
                    resumeBackgroundMusic();
                }, 500);
            }
        }

        function generateSlotResult(prizeData) {
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å–ª–æ—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∏–∑–∞
            if (prizeData.type === 'win') {
                // –î–ª—è –≤—ã–∏–≥—Ä—ã—à–∞ - —Å–ª—É—á–∞–π–Ω—ã–µ 3 –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö —Å–∏–º–≤–æ–ª–∞
                const randomSymbol = symbols[Math.floor(Math.random() * symbols.length)];
                return [randomSymbol, randomSymbol, randomSymbol];
            } else {
                // –î–ª—è –ø—Ä–æ–∏–≥—Ä—ã—à–∞ - —Ä–∞–∑–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã
                const shuffled = [...symbols].sort(() => Math.random() - 0.5);
                return [shuffled[0], shuffled[1], shuffled[2]];
            }
        }

        function animateReels(finalResult, callback) {
            const reels = [
                document.getElementById('symbols1'),
                document.getElementById('symbols2'),
                document.getElementById('symbols3')
            ];

            let completedReels = 0;

            reels.forEach((reel, index) => {
                if (!reel) {
                    console.error(`Reel ${index + 1} not found`);
                    return;
                }
                
                // –ü—Ä–æ—Å—Ç–∞—è –∞–Ω–∏–º–∞—Ü–∏—è –≤—Ä–∞—â–µ–Ω–∏—è
                const rotations = 55; // 15-25 —Å–º–µ–Ω —Å–∏–º–≤–æ–ª–æ–≤
                
                // –ê–Ω–∏–º–∏—Ä—É–µ–º –≤—Ä–∞—â–µ–Ω–∏–µ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
                setTimeout(() => {
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –≤—Ä–∞—â–µ–Ω–∏—è
                    let currentRotation = 0;
                    const rotationInterval = setInterval(() => {
                        // –ú–µ–Ω—è–µ–º —Å–∏–º–≤–æ–ª –Ω–∞ —Å–ª—É—á–∞–π–Ω—ã–π
                        const randomSymbol = symbols[Math.floor(Math.random() * symbols.length)];
                        const symbolElements = reel.querySelectorAll('.symbol');
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ —Å–∏–º–≤–æ–ª—ã –≤ –±–∞—Ä–∞–±–∞–Ω–µ
                        symbolElements.forEach(symbolEl => {
                            symbolEl.textContent = randomSymbol;
                        });
                        
                        currentRotation++;
                        if (currentRotation >= rotations) {
                            clearInterval(rotationInterval);
                            
                            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Å–∏–º–≤–æ–ª
                            setReelSymbol(index + 1, finalResult[index]);
                            completedReels++;
                            
                            if (completedReels === 3) {
                                callback();
                            }
                        }
                    }, 80); // –ú–µ–Ω—è–µ–º —Å–∏–º–≤–æ–ª –∫–∞–∂–¥—ã–µ 80–º—Å –¥–ª—è –±–æ–ª–µ–µ –ø–ª–∞–≤–Ω–æ–π –∞–Ω–∏–º–∞—Ü–∏–∏
                }, index * 200); // –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –±–∞—Ä–∞–±–∞–Ω–∞–º–∏
            });
        }

        function setReelSymbol(reelNumber, symbol) {
            const reel = document.getElementById(`symbols${reelNumber}`);
            if (!reel) {
                console.error(`Reel symbols${reelNumber} not found`);
                return;
            }
            
            const symbolElements = reel.querySelectorAll('.symbol');
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–∏–º–≤–æ–ª –≤–æ –≤—Å–µ—Ö –ø–æ–∑–∏—Ü–∏—è—Ö –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
            symbolElements.forEach(symbolEl => {
                symbolEl.textContent = symbol;
            });
        }

        function checkWin(result) {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å–ª–∏ –≤—Å–µ 3 —Å–∏–º–≤–æ–ª–∞ –æ–¥–∏–Ω–∞–∫–æ–≤—ã
            if (result[0] === result[1] && result[1] === result[2]) {
                return WIN_AMOUNT; // 300 BTC
            }
            return 0; // –ù–µ—Ç –≤—ã–∏–≥—Ä—ã—à–∞
        }

        function triggerJackpotEffect() {
            const flash = document.getElementById('jackpot-flash');
            flash.classList.add('active');
            
            setTimeout(() => {
                flash.classList.remove('active');
            }, 1500);
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤ Telegram –±–æ—Ç
        function sendToTelegramBot(data) {
            if (window.Telegram && window.Telegram.WebApp) {
                window.Telegram.WebApp.sendData(JSON.stringify(data));
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM –∑–∞–≥—Ä—É–∂–µ–Ω, –Ω–∞—á–∏–Ω–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é');
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Ç–∞–π–º–∞—É—Ç –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏
            setTimeout(() => {
                console.log('–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥');
                // –û—Ç–º–µ—á–∞–µ–º –≤—Å–µ —à–∞–≥–∏ –∫–∞–∫ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ
                Object.keys(loadingSteps).forEach(step => {
                    if (!loadingSteps[step]) {
                        console.log(`–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∑–∞–≤–µ—Ä—à–∞–µ–º —à–∞–≥: ${step}`);
                        markStepComplete(step);
                    }
                });
            }, 10000);
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
            initializePlayer();
            initAudio();
            
            // –°–∏–º—É–ª–∏—Ä—É–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ preload —à–∞–≥–∞ —á–µ—Ä–µ–∑ –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É
            setTimeout(() => {
                console.log('–ó–∞–≤–µ—Ä—à–∞–µ–º preload —à–∞–≥');
                markStepComplete('preload');
            }, 1000);
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
            if (window.Telegram && window.Telegram.WebApp) {
                window.Telegram.WebApp.ready();
                window.Telegram.WebApp.expand();
            }
            
            // –ê—É–¥–∏–æ —Ç–µ–ø–µ—Ä—å –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å"
        });
    </script>
</body>
</html>
