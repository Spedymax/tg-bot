<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé∞ –°–ª–æ—Ç-–º–∞—à–∏–Ω–∞ –ö–∞–∑–∏–Ω–æ</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:Arial,sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;display:flex;justify-content:center;align-items:center;padding:10px}
        .casino-container{text-align:center;background:rgba(255,255,255,0.1);backdrop-filter:blur(10px);border-radius:20px;padding:30px;box-shadow:0 8px 32px rgba(31,38,135,0.37);border:1px solid rgba(255,255,255,0.18);max-width:400px;width:90%}
        h1{color:#fff;margin-bottom:10px;font-size:2.5em;text-shadow:2px 2px 4px rgba(0,0,0,0.3)}
        .subtitle{color:#f0f0f0;margin-bottom:30px;font-size:1.1em}
        .info-panel{background:rgba(255,255,255,0.15);border-radius:15px;padding:20px;margin:20px 0;color:#fff}
        .info-item{display:flex;justify-content:space-between;margin:10px 0;font-size:1.1em}
        .coins{color:#f9ca24;font-weight:bold}
        .spins-left{color:#4ecdc4;font-weight:bold}
        .slot-machine{background:linear-gradient(145deg,#2c2c2c,#1a1a1a);border:8px solid #444;border-radius:20px;padding:20px;margin:40px auto;box-shadow:0 10px 30px rgba(0,0,0,0.5),inset 0 2px 5px rgba(255,255,255,0.1);position:relative;max-width:320px}
        .slot-machine-header{position:absolute;top:-45px;left:50%;transform:translateX(-50%);background:linear-gradient(145deg,#2c2c2c,#1a1a1a);padding:4px 9px;border-radius:15px;border:3px solid #444;box-shadow:0 4px 10px rgba(0,0,0,0.5)}
        .dog-image{width:60px;height:60px;border-radius:50%;object-fit:cover;border:2px solid #666}
        .reels-container{display:flex;justify-content:center;gap:10px;margin:20px 0;padding:15px;background:#000;border-radius:10px;border:3px solid #333;box-shadow:inset 0 2px 10px rgba(0,0,0,0.8)}
        .reel{width:70px;height:70px;background:linear-gradient(180deg,#333,#111);border:2px solid #555;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:2.2em;position:relative;overflow:hidden;box-shadow:inset 0 2px 5px rgba(0,0,0,0.5)}
        .reel-symbols{display:flex;flex-direction:column;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transition:transform 2s cubic-bezier(0.25,0.46,0.45,0.94)}
        .symbol{width:40px;height:100px;display:flex;align-items:center;justify-content:center;font-size:1.8em;line-height:1}
        .spin-button{background:linear-gradient(45deg,#ff6b6b,#ee5a24);color:white;border:none;padding:15px 30px;font-size:1.2em;font-weight:bold;border-radius:50px;cursor:pointer;transition:all .3s ease;box-shadow:0 4px 15px rgba(255,107,107,0.4);margin:20px 0;min-width:200px}
        .spin-button:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(255,107,107,0.6)}
        .spin-button:disabled{background:#666;cursor:not-allowed;transform:none;box-shadow:none}
        .result-display{background:rgba(255,255,255,0.2);border-radius:10px;padding:15px;margin:20px 0;color:#fff;font-size:1.2em;min-height:50px;display:flex;align-items:center;justify-content:center}
        .win-animation{animation:jackpot .8s ease-in-out infinite alternate}
        @keyframes jackpot{from{transform:scale(1);color:#fff;text-shadow:0 0 5px #fff}to{transform:scale(1.1);color:#f9ca24;text-shadow:0 0 20px #f9ca24}}
        .loading{display:none;color:#fff;font-size:1.1em;margin:10px 0}
        .loading.show{display:block}
        .payline-indicator{position:absolute;top:50%;left:0;right:0;height:2px;background:#ff6b6b;transform:translateY(-50%);opacity:0;transition:opacity .3s ease}
        .payline-indicator.active{opacity:1;box-shadow:0 0 10px #ff6b6b}
        .prize-table{background:rgba(255,255,255,0.1);border-radius:15px;padding:15px;margin:20px 0;color:#fff;font-size:.9em}
        .prize-row{display:flex;justify-content:space-between;align-items:center;padding:5px 0;border-bottom:1px solid rgba(255,255,255,0.1)}
        .prize-row:last-child{border-bottom:none}
        .symbols-combo{font-size:1.2em}
        .prize-amount{color:#f9ca24;font-weight:bold}
        .spinning .reel{animation:reel-glow .5s ease-in-out infinite alternate}
        @keyframes reel-glow{from{box-shadow:inset 0 2px 5px rgba(0,0,0,0.5)}to{box-shadow:inset 0 2px 5px rgba(0,0,0,0.5),0 0 15px rgba(255,107,107,0.5)}}
        .jackpot-flash{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(255,215,0,0.3);opacity:0;pointer-events:none;z-index:9999}
        .jackpot-flash.active{animation:flash .5s ease-in-out 3}
        @keyframes flash{0%,100%{opacity:0}50%{opacity:1}}
        .audio-controls{position:fixed;top:20px;right:20px;z-index:1000;background:rgba(0,0,0,0.7);border-radius:25px;padding:10px;display:flex;gap:10px;backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,0.2)}
        .audio-btn{background:rgba(255,255,255,0.1);border:none;color:white;padding:8px 12px;border-radius:20px;cursor:pointer;font-size:16px;transition:all .3s ease;border:1px solid rgba(255,255,255,0.2)}
        .audio-btn:hover{background:rgba(255,255,255,0.2);transform:scale(1.05)}
        .audio-btn.active{background:rgba(255,107,107,0.7);box-shadow:0 0 10px rgba(255,107,107,0.5)}
        @media (max-width:480px){.audio-controls{top:10px;right:10px;padding:8px}.audio-btn{padding:6px 10px;font-size:14px}}
        .loading-screen{position:fixed;top:0;left:0;width:100%;height:100%;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:10000;opacity:1;transition:opacity .5s ease-out}
        .loading-screen.hidden{opacity:0;pointer-events:none}
        .loading-content{text-align:center;color:white}
        .loading-title{font-size:3em;margin-bottom:20px;text-shadow:2px 2px 4px rgba(0,0,0,0.5)}
        .loading-subtitle{font-size:1.2em;margin-bottom:30px;opacity:.9}
        .loading-spinner{position:relative;width:80px;height:80px;margin:0 auto 30px}
        .loading-spinner::before{content:'üé∞';position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:3em;animation:spin 2s linear infinite}
        @keyframes spin{0%{transform:translate(-50%,-50%) rotate(0deg)}100%{transform:translate(-50%,-50%) rotate(360deg)}}
        .loading-progress{width:300px;height:4px;background:rgba(255,255,255,0.2);border-radius:2px;overflow:hidden;margin:20px auto}
        .loading-progress-bar{height:100%;background:linear-gradient(90deg,#ff6b6b,#f9ca24);border-radius:2px;width:0%;transition:width .3s ease}
        .loading-text{font-size:1em;opacity:.8;margin-top:10px}
        .loading-dots::after{content:'';animation:dots 1.5s infinite}
        @keyframes dots{0%,20%{content:''}40%{content:'.'}60%{content:'..'}80%,100%{content:'...'}}
        @keyframes pulse{0%{transform:scale(1.05)}50%{transform:scale(1.1)}100%{transform:scale(1.05)}}
        @media (max-width:480px){.loading-title{font-size:2.5em}.loading-subtitle{font-size:1em}.loading-progress{width:250px}}
    </style>
</head>
<body>
    <audio id="bgMusic" loop>
        <source src="miniapp/audio/casino_ambient.mp3" type="audio/mpeg">
        <source src="miniapp/audio/casino_ambient.ogg" type="audio/ogg">
    </audio>
    <audio id="spinSound">
        <source src="miniapp/audio/slot_spin.mp3" type="audio/mpeg">
        <source src="miniapp/audio/slot_spin.ogg" type="audio/ogg">
    </audio>
    <audio id="winSound">
        <source src="miniapp/audio/win.mp3" type="audio/mpeg">
        <source src="miniapp/audio/win.ogg" type="audio/ogg">
    </audio>
    <audio id="jackpotSound">
        <source src="miniapp/audio/jackpot.mp3" type="audio/mpeg">
        <source src="miniapp/audio/jackpot.ogg" type="audio/ogg">
    </audio>
    <div class="audio-controls">
        <button class="audio-btn" id="musicToggle" onclick="toggleMusic()" title="–í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å –º—É–∑—ã–∫—É">üéµ</button>
        <button class="audio-btn" id="soundToggle" onclick="toggleSounds()" title="–í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å –∑–≤—É–∫–∏">üîä</button>
    </div>
    <div class="jackpot-flash" id="jackpot-flash"></div>
    <div class="casino-container">
        <h1>üé∞ –°–ª–æ—Ç-–º–∞—à–∏–Ω–∞</h1>
        <p class="subtitle">–¢—Ä–∏ –≤ —Ä—è–¥ –¥–ª—è –≤—ã–∏–≥—Ä—ã—à–∞!</p>
        <div class="info-panel">
            <div class="info-item">
                <span>üéØ –°–ø–∏–Ω–æ–≤ –æ—Å—Ç–∞–ª–æ—Å—å:</span>
                <span class="spins-left" id="spins-left">6</span>
            </div>
        </div>
        <div class="slot-machine" id="slot-machine">
            <div class="slot-machine-header">
                <img src="miniapp/dog.jpg" alt="Lucky Dog" class="dog-image" id="dog-image" onerror="this.classList.add('error')">
            </div>
            <div class="payline-indicator" id="payline"></div>
            <div class="reels-container">
                <div class="reel" id="reel1">
                    <div class="reel-symbols" id="symbols1">
                        <div class="symbol">üçí</div>
                        <div class="symbol">üíé</div>
                        <div class="symbol">üçã</div>
                        <div class="symbol">üîî</div>
                        <div class="symbol">‚≠ê</div>
                        <div class="symbol">üçâ</div>
                        <div class="symbol">üí∞</div>
                    </div>
                </div>
                <div class="reel" id="reel2">
                    <div class="reel-symbols" id="symbols2">
                        <div class="symbol">üíé</div>
                        <div class="symbol">üçí</div>
                        <div class="symbol">üîî</div>
                        <div class="symbol">üçã</div>
                        <div class="symbol">üçâ</div>
                        <div class="symbol">‚≠ê</div>
                        <div class="symbol">üí∞</div>
                    </div>
                </div>
                <div class="reel" id="reel3">
                    <div class="reel-symbols" id="symbols3">
                        <div class="symbol">üçã</div>
                        <div class="symbol">üîî</div>
                        <div class="symbol">üíé</div>
                        <div class="symbol">üçí</div>
                        <div class="symbol">üí∞</div>
                        <div class="symbol">üçâ</div>
                        <div class="symbol">‚≠ê</div>
                    </div>
                </div>
            </div>
        </div>
        <button class="spin-button" id="spin-btn" onclick="spinSlots()">üé≤ –ö–†–£–¢–ò–¢–¨ –°–õ–û–¢–´</button>
        <div class="loading" id="loading">‚è≥ –°–ª–æ—Ç—ã –∫—Ä—É—Ç—è—Ç—Å—è...</div>
        <div class="result-display" id="result">–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –∏–≥—Ä—É!</div>
        <div class="prize-table">
            <div style="text-align:center;margin-bottom:10px;font-weight:bold;">üèÜ –¢–∞–±–ª–∏—Ü–∞ –≤—ã–ø–ª–∞—Ç</div>
            <div class="prize-row">
                <span class="symbols-combo">üéé –õ—é–±—ã–µ 3 –≤ —Ä—è–¥ üéé</span>
                <span class="prize-amount">300 BTC</span>
            </div>
            <div class="prize-row">
                <span class="symbols-combo">üòï –ù–µ —Å–æ–≤–ø–∞–ª–∏</span>
                <span class="prize-amount">0 BTC</span>
            </div>
        </div>
    </div>
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-content">
            <div class="loading-title">–ó–∞–≥—Ä—É–∑–∫–∞</div>
            <div class="loading-subtitle">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ...</div>
            <div class="loading-spinner"></div>
            <div class="loading-progress">
                <div class="loading-progress-bar" id="loadingProgressBar"></div>
            </div>
            <div class="loading-text">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è<span class="loading-dots"></span></div>
            <div id="loadingButtonContainer" style="margin-top:20px;height:50px"></div>
        </div>
    </div>
    <script>
        let currentCoins = 0;
        let spinsLeft = 6;
        let isSpinning = false;
        let playerId = null;
        let apiBaseUrl = window.location.origin + '/miniapp';
        let musicEnabled = true;
        let soundsEnabled = true;
        let audioElements = {};
        let loadingSteps = {player:false,audio:false,preload:false};
        function updateLoadingProgress(){
            const completedSteps = Object.values(loadingSteps).filter(Boolean).length;
            const totalSteps = Object.keys(loadingSteps).length;
            const progress = (completedSteps/totalSteps)*100;
            const progressBar = document.getElementById('loadingProgressBar');
            if(progressBar)progressBar.style.width=progress+'%';
            const loadingText = document.querySelector('.loading-text');
            if(loadingText){
                let text='–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è';
                if(loadingSteps.player && !loadingSteps.audio)text='–ó–∞–≥—Ä—É–∑–∫–∞ –∞—É–¥–∏–æ';
                else if(loadingSteps.player && loadingSteps.audio && !loadingSteps.preload)text='–ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤';
                else if(completedSteps===totalSteps)text='–ì–æ—Ç–æ–≤–æ';
                if(completedSteps<totalSteps)loadingText.innerHTML=text+'<span class="loading-dots"></span>'; else loadingText.innerHTML=text;
            }
            if(completedSteps===totalSteps)setTimeout(showContinueButton,800);
        }
        function showContinueButton(){
            const buttonContainer=document.getElementById('loadingButtonContainer');
            if(buttonContainer){
                const continueButton=document.createElement('button');
                continueButton.textContent='üéµ –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å';
                continueButton.onclick=continueToApp;
                continueButton.style.cssText="background:linear-gradient(45deg,#ff6b6b,#ee5a24);color:white;border:none;padding:15px 30px;font-size:1.2em;font-weight:bold;border-radius:50px;cursor:pointer;box-shadow:0 4px 15px rgba(255,107,107,0.4);animation:pulse 2s infinite;transition:all .3s ease";
                continueButton.addEventListener('mouseenter',function(){this.style.transform='translateY(-2px) scale(1.05)';this.style.boxShadow='0 6px 20px rgba(255,107,107,0.6)'});continueButton.addEventListener('mouseleave',function(){this.style.transform='none';this.style.boxShadow='0 4px 15px rgba(255,107,107,0.4)'});
                buttonContainer.appendChild(continueButton);
            }
        }
        function continueToApp(){if(musicEnabled)startBackgroundMusic();hideLoadingScreen()}
        function hideLoadingScreen(){const loadingScreen=document.getElementById('loadingScreen');if(loadingScreen){loadingScreen.classList.add('hidden');setTimeout(()=>{loadingScreen.remove()},500)}}
        function markStepComplete(step){loadingSteps[step]=true;updateLoadingProgress()}
        function initAudio(){
            audioElements={bgMusic:document.getElementById('bgMusic'),spinSound:document.getElementById('spinSound'),winSound:document.getElementById('winSound'),jackpotSound:document.getElementById('jackpotSound')};
            if(audioElements.bgMusic)audioElements.bgMusic.volume=0.3;
            if(audioElements.spinSound)audioElements.spinSound.volume=0.5;
            if(audioElements.winSound)audioElements.winSound.volume=0.7;
            if(audioElements.jackpotSound)audioElements.jackpotSound.volume=0.8;
            const savedMusicSetting=localStorage.getItem('casinoMusicEnabled');
            const savedSoundsSetting=localStorage.getItem('casinoSoundsEnabled');
            if(savedMusicSetting!==null)musicEnabled=savedMusicSetting==='true';
            if(savedSoundsSetting!==null)soundsEnabled=savedSoundsSetting==='true';
            updateAudioButtons();
            markStepComplete('audio');
        }
        function playSound(soundName){if(!soundsEnabled||!audioElements[soundName])return;try{audioElements[soundName].currentTime=0;audioElements[soundName].play().catch(()=>{})}catch(e){}}
        function toggleMusic(){musicEnabled=!musicEnabled;localStorage.setItem('casinoMusicEnabled',musicEnabled.toString());if(musicEnabled)startBackgroundMusic();else stopBackgroundMusic();updateAudioButtons()}
        function toggleSounds(){soundsEnabled=!soundsEnabled;localStorage.setItem('casinoSoundsEnabled',soundsEnabled.toString());updateAudioButtons()}
        function updateAudioButtons(){const musicBtn=document.getElementById('musicToggle');const soundBtn=document.getElementById('soundToggle');if(musicBtn){musicBtn.classList.toggle('active',musicEnabled);musicBtn.textContent=musicEnabled?'üéµ':'üîá'}if(soundBtn){soundBtn.classList.toggle('active',soundsEnabled);soundBtn.textContent=soundsEnabled?'üîä':'üîá'}}
        function startBackgroundMusic(){if(musicEnabled&&audioElements.bgMusic&&!isSpinning){audioElements.bgMusic.play().catch(()=>{})}}
        function stopBackgroundMusic(){if(audioElements.bgMusic)audioElements.bgMusic.pause()}
        function pauseBackgroundMusic(){if(audioElements.bgMusic&&!audioElements.bgMusic.paused){audioElements.bgMusic.pause()}}
        function resumeBackgroundMusic(){if(musicEnabled&&audioElements.bgMusic&&audioElements.bgMusic.paused){audioElements.bgMusic.play().catch(()=>{})}}
        const symbols=['üçí','üíé','üçã','üîî','‚≠ê','üçâ','üí∞'];
        async function initializePlayer() {
            try {
                if (window.Telegram && window.Telegram.WebApp) {
                    const tg = window.Telegram.WebApp;
                    tg.ready(); // Telegram –≥–æ–≤–æ—Ä–∏—Ç, —á—Ç–æ –º–æ–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å
                    playerId = tg.initDataUnsafe?.user?.id;
                }

                // –§–æ–ª–ª–±–µ–∫ –¥–ª—è —Ç–µ—Å—Ç–∞ –≤–Ω–µ Telegram
                if (!playerId) {
                    console.warn('Player ID not found, using test ID');
                    playerId = 4321;
                }

                const response = await fetch(`${apiBaseUrl}/api/player/${playerId}`);
                const data = await response.json();

                if (data.success) {
                    currentCoins = data.data.coins;
                    spinsLeft = data.data.spins_left;
                    updateDisplay();
                    markStepComplete('player');
                } else {
                    throw new Error(data.error || 'Failed to load player data');
                }
            } catch (e) {
                console.error('Error initializing player:', e);
                currentCoins = 100;
                spinsLeft = 6;
                updateDisplay();
                markStepComplete('player');
            }
        }

        function updateDisplay(){document.getElementById('spins-left').textContent=spinsLeft;const spinBtn=document.getElementById('spin-btn');if(spinsLeft<=0){spinBtn.disabled=true;spinBtn.textContent='üö´ –ù–ï–¢ –°–ü–ò–ù–û–í'}else{spinBtn.disabled=false;spinBtn.textContent='üé≤ –ö–†–£–¢–ò–¢–¨ –°–õ–û–¢–´'}}
        async function spinSlots(){
            if(isSpinning||spinsLeft<=0||!playerId)return;
            isSpinning=true;
            const spinBtn=document.getElementById('spin-btn');
            const loading=document.getElementById('loading');
            const result=document.getElementById('result');
            const slotMachine=document.getElementById('slot-machine');
            const payline=document.getElementById('payline');
            loading.classList.add('show');
            spinBtn.disabled=true;
            result.textContent='';
            slotMachine.classList.add('spinning');
            payline.classList.add('active');
            pauseBackgroundMusic();
            try{
                const response=await fetch(`${apiBaseUrl}/api/spin`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({player_id:playerId})});
                const spinData=await response.json();
                if(spinData.success){
                    const slotResult=generateSlotResult(spinData.data.prize);
                    playSound('spinSound');
                    animateReels(slotResult,()=>{
                        currentCoins=spinData.data.coins;
                        spinsLeft=spinData.data.spins_left;
                        const coins_gained = spinData.data.coins_gained || 0;
                        loading.classList.remove('show');
                        slotMachine.classList.remove('spinning');
                        payline.classList.remove('active');
                        if(coins_gained>0){
                            if(coins_gained>=500){
                                triggerJackpotEffect();
                                playSound('jackpotSound');
                            }else{
                                playSound('winSound');
                            }
                            result.textContent=`üéâ –í–´–ò–ì–†–´–®! +${coins_gained} BTC`;
                            result.classList.add('win-animation');
                            payline.classList.add('active');
                        }else{
                            result.textContent=spinData.data.prize?.text||'–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑! üé≤';
                        }
                        setTimeout(()=>{result.classList.remove('win-animation');payline.classList.remove('active')},2000);
                        updateDisplay();
                        isSpinning=false;
                        setTimeout(()=>{resumeBackgroundMusic()},500);
                    });
                }else{
                    throw new Error(spinData.error||'Spin failed');
                }
            }catch(error){
                loading.classList.remove('show');
                slotMachine.classList.remove('spinning');
                payline.classList.remove('active');
                document.getElementById('result').textContent=`‚ùå –û—à–∏–±–∫–∞: ${error.message}`;
                isSpinning=false;
                spinBtn.disabled=false;
                setTimeout(()=>{resumeBackgroundMusic()},500);
            }
        }
        function generateSlotResult(prizeData){
            if(prizeData && prizeData.type && prizeData.type!=='lose'){
                const randomSymbol=symbols[Math.floor(Math.random()*symbols.length)];
                return [randomSymbol,randomSymbol,randomSymbol];
            }else{
                const shuffled=[...symbols].sort(()=>Math.random()-0.5);
                return [shuffled[0],shuffled[1],shuffled[2]];
            }
        }
        function animateReels(finalResult,callback){
            const reels=[document.getElementById('symbols1'),document.getElementById('symbols2'),document.getElementById('symbols3')];
            let completedReels=0;
            reels.forEach((reel,index)=>{
                if(!reel)return;
                const rotations=55;
                setTimeout(()=>{
                    let currentRotation=0;
                    const rotationInterval=setInterval(()=>{
                        const randomSymbol=symbols[Math.floor(Math.random()*symbols.length)];
                        const symbolElements=reel.querySelectorAll('.symbol');
                        symbolElements.forEach(symbolEl=>{symbolEl.textContent=randomSymbol});
                        currentRotation++;
                        if(currentRotation>=rotations){
                            clearInterval(rotationInterval);
                            setReelSymbol(index+1,finalResult[index]);
                            completedReels++;
                            if(completedReels===3)callback();
                        }
                    },80);
                },index*200);
            });
        }
        function setReelSymbol(reelNumber,symbol){
            const reel=document.getElementById(`symbols${reelNumber}`);
            if(!reel)return;
            const symbolElements=reel.querySelectorAll('.symbol');
            symbolElements.forEach(symbolEl=>{symbolEl.textContent=symbol});
        }
        function triggerJackpotEffect(){
            const flash=document.getElementById('jackpot-flash');
            flash.classList.add('active');
            setTimeout(()=>{flash.classList.remove('active')},1500);
        }
        function sendToTelegramBot(data){if(window.Telegram&&window.Telegram.WebApp)window.Telegram.WebApp.sendData(JSON.stringify(data))}
        document.addEventListener('DOMContentLoaded',function(){
            setTimeout(()=>{Object.keys(loadingSteps).forEach(step=>{if(!loadingSteps[step])markStepComplete(step)})},10000);
            initializePlayer();
            initAudio();
            setTimeout(()=>{markStepComplete('preload')},1000);
            if(window.Telegram&&window.Telegram.WebApp){window.Telegram.WebApp.ready();window.Telegram.WebApp.expand()}
        });
    </script>
</body>
</html>
